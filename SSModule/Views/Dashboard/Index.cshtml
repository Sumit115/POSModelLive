@model SSRepository.Models.DashboardSummaryModel
@{
    Layout = "_Layout";
    ViewData["bdClass"] = "summary";
    List<SSRepository.Models.MenuModel> _menuList = ViewBag.Menulist;
    int isDashBoardPermission = 0;
    if (_menuList != null)
    {
        isDashBoardPermission = _menuList.ToList().Where(x => x.FormName == "Dashboard" && x.IsAccess).FirstOrDefault() != null ? 1 : 0;
    }
}
@if (isDashBoardPermission == 1)
{
    <style>
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            z-index: 1000;
        }

        .popup-content {
            background: white;
            width: 600px;
            padding: 20px;
            margin: 100px auto;
            position: relative;
            border-radius: 10px;
        }

        .close-btn {
            position: absolute;
            top: -10px;
            right: 3px;
            cursor: pointer;
            font-size: 25px;
        }

    </style>
    <style>
        #chartContainer {
            display: inline-flex;
            align-items: flex-start;
            justify-content: center;
            gap: 20px;
        }

        #legend {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 14px;
            text-align: left;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
        }
    </style>
    <div style="background-color:#fafbfe;overflow: auto;">

        <div class="row mt-4 pl-3 pr-3 SalesSummary">
            <div class="col-md-12 box ps-0">
                <h6>
                    Today
                </h6>
            </div>
            <div class="col-md-2 box ps-0">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_PurchaseInvoice_Today">@Model.TotalAmount_PurchaseInvoice</span></h5>
                        <p class="mb-0 pt-1 Name">Purchase</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Purchase <span id="TotalCount_PurchaseInvoice_Today">@Model.TotalCount_PurchaseInvoice</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-2 box">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesOrder_Today">@Model.TotalAmount_SalesOrder</span></h5>
                        <p class="mb-0 pt-1 Name">Sales Order</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Order <span id="TotalCount_SalesOrder_Today">@Model.TotalCount_SalesOrder</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-2 box">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2 open-popup" data-modal="#myPopup_SalesInvoice_Today">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesInvoice_Today">@Model.TotalAmount_SalesInvoice</span></h5>
                        <p class="mb-0 pt-1 Name">Sales</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Sales <span id="TotalCount_SalesInvoice_Today">@Model.TotalCount_SalesInvoice</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-box"></i>
                    </div>
                </div>
                <div id="myPopup_SalesInvoice_Today" class="popup-overlay" style="display: none;">
                    <div class="popup-content">
                        <span class="close-btn">&times;</span>
                        <div class="row">
                            <div class="col-md-6 box">
                                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                                    <div class="p-2">
                                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesInvoiceWholesale_Today">@Model.TotalAmount_SalesInvoiceWholesale_Today</span></h5>
                                        <p class="mb-0 pt-1 Name">Wholesale</p>
                                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Sales <span id="TotalCount_SalesInvoiceWholesale_Today">@Model.TotalCount_SalesInvoiceWholesale_Today</span></h6>
                                    </div>
                                    <div class="icon-wrapper mr-2 mt-2">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 box">
                                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                                    <div class="p-2">
                                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesInvoiceWalking_Today">@Model.TotalAmount_SalesInvoiceWalking_Today</span></h5>
                                        <p class="mb-0 pt-1 Name">Walking</p>
                                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Sales <span id="TotalCount_SalesInvoiceWalking_Today">@Model.TotalCount_SalesInvoiceWalking_Today</span></h6>
                                    </div>
                                    <div class="icon-wrapper mr-2 mt-2">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-2 box">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesChallan_Today">@Model.TotalAmount_SalesChallan</span></h5>
                        <p class="mb-0 pt-1 Name">Sales Challan</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Challan <span id="TotalCount_SalesChallan_Today">@Model.TotalCount_SalesChallan</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
            </div>

        </div>
        <div class="row mt-4 pl-3 pr-3 SalesSummary">
            <div class="col-md-12 box ps-0">
                <h6> <span id="MonthName_selected"></span> Month Data</h6>
            </div>
            <div class="col-md-2 box ps-0">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_PurchaseInvoice">@Model.TotalAmount_PurchaseInvoice</span></h5>
                        <p class="mb-0 pt-1 Name">Purchase</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Purchase <span id="TotalCount_PurchaseInvoice">@Model.TotalCount_PurchaseInvoice</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-2 box">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesOrder">@Model.TotalAmount_SalesOrder</span></h5>
                        <p class="mb-0 pt-1 Name">Sales Order</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Order <span id="TotalCount_SalesOrder">@Model.TotalCount_SalesOrder</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-2 box">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2 open-popup" data-modal="#myPopup_SalesInvoice">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesInvoice">@Model.TotalAmount_SalesInvoice</span></h5>
                        <p class="mb-0 pt-1 Name">Sales</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Sales <span id="TotalCount_SalesInvoice">@Model.TotalCount_SalesInvoice</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-box"></i>
                    </div>
                </div>
                <div id="myPopup_SalesInvoice" class="popup-overlay" style="display: none;">
                    <div class="popup-content">
                        <span class="close-btn">&times;</span>
                        <div class="row">
                            <div class="col-md-6 box">
                                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                                    <div class="p-2">
                                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesInvoiceWholesale">@Model.TotalAmount_SalesInvoiceWholesale</span></h5>
                                        <p class="mb-0 pt-1 Name">Wholesale</p>
                                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Sales <span id="TotalCount_SalesInvoiceWholesale">@Model.TotalCount_SalesInvoiceWholesale</span></h6>
                                    </div>
                                    <div class="icon-wrapper mr-2 mt-2">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 box">
                                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                                    <div class="p-2">
                                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesInvoiceWalking">@Model.TotalAmount_SalesInvoiceWalking</span></h5>
                                        <p class="mb-0 pt-1 Name">Walking</p>
                                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Sales <span id="TotalCount_SalesInvoiceWalking">@Model.TotalCount_SalesInvoiceWalking</span></h6>
                                    </div>
                                    <div class="icon-wrapper mr-2 mt-2">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-2 box">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesChallan">@Model.TotalAmount_SalesChallan</span></h5>
                        <p class="mb-0 pt-1 Name">Sales Challan</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Challan <span id="TotalCount_SalesChallan">@Model.TotalCount_SalesChallan</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
            </div>

        </div>

        <div class="row mt-4 pl-3 pr-3 SalesSummary">
            <div class="col-md-12 box ps-0">
                <h6>
                    FY <span>@(!string.IsNullOrEmpty(ViewBag.FinYear) ? (ViewBag.FinYear + "-" + ((Convert.ToInt32(ViewBag.FinYear)) + 1)) : "2025-2026")</span>
                    Data
                </h6>
            </div>
            <div class="col-md-2 box ps-0">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_PurchaseInvoice_FY">@Model.TotalAmount_PurchaseInvoice</span></h5>
                        <p class="mb-0 pt-1 Name">Purchase</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Purchase <span id="TotalCount_PurchaseInvoice_FY">@Model.TotalCount_PurchaseInvoice</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-2 box">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesOrder_FY">@Model.TotalAmount_SalesOrder</span></h5>
                        <p class="mb-0 pt-1 Name">Sales Order</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Order <span id="TotalCount_SalesOrder_FY">@Model.TotalCount_SalesOrder</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-2 box">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2 open-popup" data-modal="#myPopup_SalesInvoice_FY">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesInvoice_FY">@Model.TotalAmount_SalesInvoice</span></h5>
                        <p class="mb-0 pt-1 Name">Sales</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Sales <span id="TotalCount_SalesInvoice_FY">@Model.TotalCount_SalesInvoice</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-box"></i>
                    </div>
                </div>
                <div id="myPopup_SalesInvoice_FY" class="popup-overlay" style="display: none;">
                    <div class="popup-content">
                        <span class="close-btn">&times;</span>
                        <div class="row">
                            <div class="col-md-6 box">
                                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                                    <div class="p-2">
                                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesInvoiceWholesale_FY">@Model.TotalAmount_SalesInvoiceWholesale_FY</span></h5>
                                        <p class="mb-0 pt-1 Name">Wholesale</p>
                                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Sales <span id="TotalCount_SalesInvoiceWholesale_FY">@Model.TotalCount_SalesInvoiceWholesale_FY</span></h6>
                                    </div>
                                    <div class="icon-wrapper mr-2 mt-2">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 box">
                                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                                    <div class="p-2">
                                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesInvoiceWalking_FY">@Model.TotalAmount_SalesInvoiceWalking_FY</span></h5>
                                        <p class="mb-0 pt-1 Name">Walking</p>
                                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Sales <span id="TotalCount_SalesInvoiceWalking_FY">@Model.TotalCount_SalesInvoiceWalking_FY</span></h6>
                                    </div>
                                    <div class="icon-wrapper mr-2 mt-2">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-2 box">
                <div class="d-flex flex-row justify-content-between align-items-left mb-3 card card-overview p-2">
                    <div class="p-2">
                        <h5 class="mb-0 font-weight-bold Amount" style="font-size:16px;">₹ <span id="TotalAmount_SalesChallan_FY">@Model.TotalAmount_SalesChallan</span></h5>
                        <p class="mb-0 pt-1 Name">Sales Challan</p>
                        <h6 class="text-success info-text-sales mb-0 pt-1 UpDown Quantity">No. Of Challan <span id="TotalCount_SalesChallan_FY">@Model.TotalCount_SalesChallan</span></h6>
                    </div>
                    <div class="icon-wrapper mr-2 mt-2">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
            </div>

        </div>

        <div class="row mt-4 pl-3 pr-3">
            <div class="col-md-8">
                <div class="card" style="height: 495px!important;">
                    <div class="card-header header_graph">
                        Current Month
                    </div>
                    <div class="card-body">

                        <div id="morris-area-chart"></div>

                    </div>

                    <div class="card-footer bg-transparent">
                        <div class="row">

                            <div class="col-3">
                                <span class="mr-3">
                                    <i class="fa fa-circle m-r-5" style="color:#4a23ad"></i> &nbsp;&nbsp;Purchase Amount&nbsp;&nbsp;
                                    <input type="checkbox" name="MorrisChartKey" value="PurchaseInvoiceAmount" data-label="Purchase Amount" data-linecolor="#4a23ad" onchange="Load_Morris_Area_Chart_Data()" checked />
                                </span>
                            </div>
                            <div class="col-3">
                                <span class="mr-3">
                                    <i class="fa fa-circle m-r-5" style="color:#00bbd9"></i>
                                    &nbsp;&nbsp;Purchase Count &nbsp;&nbsp;
                                    <input type="checkbox" name="MorrisChartKey" value="PurchaseInvoiceCount" data-label="Purchase Count" data-linecolor="#00bbd9" onchange="Load_Morris_Area_Chart_Data()" checked />
                                </span>
                            </div>
                            <div class="col-3">
                                <span class="mr-3">
                                    <i class="fa fa-circle m-r-5" style="color:#2ecc71"></i> &nbsp;&nbsp;
                                    Sales Amount&nbsp;&nbsp;
                                    <input type="checkbox" name="MorrisChartKey" value="SalesInvoiceAmount" data-label="Sales Amount" data-linecolor="#2ecc71" onchange="Load_Morris_Area_Chart_Data()" checked />
                                </span>
                            </div>
                            <div class="col-3">
                                <span class="mr-3">
                                    <i class="fa fa-circle m-r-5" style="color:#fd8a14"></i>
                                    &nbsp;&nbsp;Sales Count&nbsp;&nbsp;
                                    <input type="checkbox" name="MorrisChartKey" value="SalesInvoiceCount" data-label="Sales Count" data-linecolor="#fd8a14" onchange="Load_Morris_Area_Chart_Data()" checked />
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-md-4">
                <div class="card" style="height: 495px!important;">
                    <div class="card-header header_graph">
                        Current Month
                    </div>
                    <div class="card-body">

                        <div id="chartContainer">
                            <canvas id="pieChart" width="300" height="300" style="cursor:pointer;"></canvas>
                            <div id="legend"></div>
                        </div>
                    </div>


                </div>

            </div>
        </div>
        <div class="row mt-4 pl-3 pr-3">
            <div class="col-md-4">
                <div class="card" style="height: 250px!important;">
                    <div class="card-header">
                        Top Selling Article
                    </div>
                    <div class="card-body">
                        <table id="tblTopProducts" class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Qty</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>


                </div>

            </div>

            <div class="col-md-4">
                <div class="card" style="height: 250px!important;">
                    <div class="card-header">
                        Top Customer
                    </div>
                    <div class="card-body">
                        <table id="tblTopCustomers" class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Mobile</th>
                                    <th>Total Invoice</th>
                                    <th>Total Amount</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>


                </div>

            </div>
            <div class="col-md-4">
                <div class="card" style="height: 250px!important;">
                    <div class="card-header">
                        Top Vendor
                    </div>
                    <div class="card-body">
                        <table id="tblTopVendors" class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Mobile</th>
                                    <th>Total Invoice</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>


                </div>

            </div>
        </div>
    </div>
    <input type="hidden" id="hdGraphData_MorrisAreaChart" value="@Newtonsoft.Json.JsonConvert.SerializeObject(Model.GraphDataList)" />
    <input type="hidden" id="hdPieChartData_SaleAmt" value="[]" />
    <input type="hidden" id="hdTopCustomerList" value="[]" />
    <input type="hidden" id="hdTopVendorList" value="[]" />
    <input type="hidden" id="hdTopSellingProductList" value="[]" />
}
@section Scripts {
    <link href="~/morris/morris.css" rel="stylesheet" />
    <script src="~/morris/morris.js"></script>
    <script src="~/morris/raphael.js"></script>
    <script>
        $(document).ready(function () {
            $("#ddlMonth_Summary").val(@DateTime.Now.Month);
            $("#MonthName_selected").text($("#ddlMonth_Summary option:selected").text());
            if (@isDashBoardPermission== 1) {
                DashboardSummary();
            }
            $("#ddlMonth_Summary").on("change", function () {
                $("#MonthName_selected").text($("#ddlMonth_Summary option:selected").text());
                DashboardSummary();
            });
            $(document).on('click', '.open-popup', function (e) {
                e.preventDefault();
                const modalId = $(this).data('modal');
                $(modalId).fadeIn();
            });

            $(document).on('click', '.close-btn', function () {
                $(this).closest('.popup-overlay').fadeOut();
            });
            // Load_Morris_Area_Chart_Data();
        });
        var display_date = function (d) {
            var month = d.getMonth() + 1,
                day = d.getDate(),
                year = d.getFullYear();

            var formattedDay = (day < 10 ? '0' + day : day);// + '-' + (month < 10 ? '0' + month : month) + '-' + year;

            return formattedDay; // Return "M-DD" format for date
        }

        function Load_Morris_Area_Chart_Data() {

            $("#morris-area-chart").html('');
            //  $("#span_graphHeading").text('Last_30_Days_Data');

            var ItemList = JSON.parse($("#hdGraphData_MorrisAreaChart").val());
            var xkey = 'Date';
            var ykeys = [];
            var labels = [];
            var pointStrokeColors = [];
            var lineColors = [];

            $('input[name=MorrisChartKey]').each(function () {
                if (this.checked) {
                    ykeys.push($(this).val());
                    labels.push($(this).attr('data-label'));
                    pointStrokeColors.push($(this).attr('data-linecolor'));
                    lineColors.push($(this).attr('data-linecolor'));
                }
            });
            //console.log(ykeys);


            Morris.Area({
                element: 'morris-area-chart',
                data: ItemList,
                //data: ItemList.map(o => ({ Date: moment(o.Date, 'YYYY-MM-DD').format('YYYY-DD-MM'), SalesInvoiceAmount: o.SalesInvoiceAmount })),

                xkey: xkey,
                ykeys: ykeys,
                labels: labels,
                xLabelFormat: function (x) { return display_date(x); },
                // xKeyFormat: function (x) { return display_date(x); },
                // xLabels: 'day',
                //xLabels: function (d) {
                //    return ("0" + d.getDate()).slice(-2) + '-' + ("0" + (d.getMonth() + 1)).slice(-2) + '-' + d.getFullYear();
                //},
                pointSize: 3,
                fillOpacity: 0,
                pointStrokeColors: pointStrokeColors,
                behaveLikeLine: true,
                gridLineColor: '#e0e0e0',
                lineWidth: 1,
                hideHover: 'auto',
                lineColors: lineColors,
                resize: true

            });
            //s = s.substring(0, s.indexOf('?'));
            //$(".morris-hover-row-label").each(function () {
            //
            //    var s = $(this).text();
            //    var aa = s.substring(0, s.indexOf('T'));
            //    $(this).text(aa);
            //});
        }

        function drawPieChart() {
            const data = JSON.parse($("#hdPieChartData_SaleAmt").val())[0];
            if (!data) return;

            const colorMap = {
                CashAmt: "#4caf50",
                CreditAmt: "#2196f3",
                ChequeAmt: "#ff9800",
                CreditCardAmt: "#9c27b0"
            };

            const chartData = Object.entries(data).map(([key, value]) => ({
                label: key.replace("Amt", ""),
                value: value,
                color: colorMap[key] || "#ccc"
            }));

            const canvas = document.getElementById("pieChart");
            const ctx = canvas.getContext("2d");
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            const radius = 120;

            const total = chartData.reduce((sum, d) => sum + d.value, 0);
            let startAngle = 0;
            let angles = [];

            // Store start/end angles for hover detection
            chartData.forEach(d => {
                const sliceAngle = (d.value / total) * 2 * Math.PI;
                angles.push({ start: startAngle, end: startAngle + sliceAngle });
                startAngle += sliceAngle;
            });

            function render(highlightIndex = -1) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let start = 0;

                chartData.forEach((d, i) => {
                    const sliceAngle = (d.value / total) * 2 * Math.PI;
                    const midAngle = start + sliceAngle / 2;

                    // “Pop out” effect for hovered slice
                    const offset = (i === highlightIndex) ? 10 : 0;
                    const xOffset = Math.cos(midAngle) * offset;
                    const yOffset = Math.sin(midAngle) * offset;

                    ctx.beginPath();
                    ctx.moveTo(cx + xOffset, cy + yOffset);
                    ctx.arc(cx + xOffset, cy + yOffset, radius, start, start + sliceAngle);
                    ctx.closePath();

                    // Shadow for 3D look
                    if (i === highlightIndex) {
                        ctx.shadowColor = "rgba(0,0,0,0.4)";
                        ctx.shadowBlur = 10;
                    } else {
                        ctx.shadowBlur = 0;
                    }

                    ctx.fillStyle = d.color;
                    ctx.fill();

                    // Label
                    const labelX = cx + Math.cos(midAngle) * (radius * 0.6) + xOffset;
                    const labelY = cy + Math.sin(midAngle) * (radius * 0.6) + yOffset;
                    const percent = ((d.value / total) * 100).toFixed(1) + "%";
                    ctx.fillStyle = "#fff";
                    ctx.font = "bold 14px Arial";
                    ctx.textAlign = "center";
                    ctx.fillText(d.label, labelX, labelY - 8);
                    ctx.fillText(percent, labelX, labelY + 8);

                    start += sliceAngle;
                });
            }

            render();

            // Handle hover
            canvas.addEventListener("mousemove", (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left - cx;
                const y = e.clientY - rect.top - cy;
                const angle = Math.atan2(y, x);
                const dist = Math.sqrt(x * x + y * y);

                if (dist < radius) {
                    let hoverIndex = -1;
                    let a = angle < 0 ? angle + 2 * Math.PI : angle;
                    for (let i = 0; i < angles.length; i++) {
                        if (a >= angles[i].start && a < angles[i].end) {
                            hoverIndex = i;
                            break;
                        }
                    }
                    render(hoverIndex);
                } else {
                    render(-1);
                }
            });

            // Legend
            const legend = $("#legend").empty();
            chartData.forEach(d => {
                legend.append(`<div class="legend-item"><div class="legend-color" style="background:${d.color}"></div>${d.label}: ${d.value.toLocaleString()}</div>`);
            });
        }


        function DashboardSummary() {
            var Month = $("#ddlMonth_Summary").val();
            $(".header_graph").text($("#ddlMonth_Summary option:selected").text() + " Month Data");
            $.ajax({
                type: "POST",
                url: '/Transactions/SalesInvoice/DashboardSummary',
                data: { Month },
                datatype: "json",
                success: function (res) {
                    //console.log(res);
                    if (res.status == "success") {
                        // console.log(res.data);
                        var _d = res.data;

                        $("#TotalCount_PurchaseInvoice_Today").text(_d.TotalCount_PurchaseInvoice_Today);
                        $("#TotalAmount_PurchaseInvoice_Today").text(_d.TotalAmount_PurchaseInvoice_Today);
                        $("#TotalCount_SalesOrder_Today").text(_d.TotalCount_SalesOrder_Today);
                        $("#TotalAmount_SalesOrder_Today").text(_d.TotalAmount_SalesOrder_Today);
                        $("#TotalCount_SalesInvoice_Today").text(_d.TotalCount_SalesInvoice_Today);
                        $("#TotalAmount_SalesInvoice_Today").text(_d.TotalAmount_SalesInvoice_Today);
                        $("#TotalCount_SalesInvoiceWholesale_Today").text(_d.TotalCount_SalesInvoiceWholesale_Today);
                        $("#TotalAmount_SalesInvoiceWholesale_Today").text(_d.TotalAmount_SalesInvoiceWholesale_Today);
                        $("#TotalCount_SalesInvoiceWalking_Today").text(_d.TotalCount_SalesInvoiceWalking_Today);
                        $("#TotalAmount_SalesInvoiceWalking_Today").text(_d.TotalAmount_SalesInvoiceWalking_Today);
                        $("#TotalCount_SalesChallan_Today").text(_d.TotalCount_SalesChallan_Today);
                        $("#TotalAmount_SalesChallan_Today").text(_d.TotalAmount_SalesChallan_Today);


                        $("#TotalCount_PurchaseInvoice").text(_d.TotalCount_PurchaseInvoice);
                        $("#TotalAmount_PurchaseInvoice").text(_d.TotalAmount_PurchaseInvoice);
                        $("#TotalCount_SalesOrder").text(_d.TotalCount_SalesOrder);
                        $("#TotalAmount_SalesOrder").text(_d.TotalAmount_SalesOrder);
                        $("#TotalCount_SalesInvoice").text(_d.TotalCount_SalesInvoice);
                        $("#TotalAmount_SalesInvoice").text(_d.TotalAmount_SalesInvoice);
                        $("#TotalCount_SalesInvoiceWholesale").text(_d.TotalCount_SalesInvoiceWholesale);
                        $("#TotalAmount_SalesInvoiceWholesale").text(_d.TotalAmount_SalesInvoiceWholesale);
                        $("#TotalCount_SalesInvoiceWalking").text(_d.TotalCount_SalesInvoiceWalking);
                        $("#TotalAmount_SalesInvoiceWalking").text(_d.TotalAmount_SalesInvoiceWalking);
                        $("#TotalCount_SalesChallan").text(_d.TotalCount_SalesChallan);
                        $("#TotalAmount_SalesChallan").text(_d.TotalAmount_SalesChallan);

                        $("#TotalCount_PurchaseInvoice_FY").text(_d.TotalCount_PurchaseInvoice_FY);
                        $("#TotalAmount_PurchaseInvoice_FY").text(_d.TotalAmount_PurchaseInvoice_FY);
                        $("#TotalCount_SalesOrder_FY").text(_d.TotalCount_SalesOrder_FY);
                        $("#TotalAmount_SalesOrder_FY").text(_d.TotalAmount_SalesOrder_FY);
                        $("#TotalCount_SalesInvoice_FY").text(_d.TotalCount_SalesInvoice_FY);
                        $("#TotalAmount_SalesInvoice_FY").text(_d.TotalAmount_SalesInvoice_FY);
                        $("#TotalCount_SalesInvoiceWholesale_FY").text(_d.TotalCount_SalesInvoiceWholesale_FY);
                        $("#TotalAmount_SalesInvoiceWholesale_FY").text(_d.TotalAmount_SalesInvoiceWholesale_FY);
                        $("#TotalCount_SalesInvoiceWalking_FY").text(_d.TotalCount_SalesInvoiceWalking_FY);
                        $("#TotalAmount_SalesInvoiceWalking_FY").text(_d.TotalAmount_SalesInvoiceWalking_FY);
                        $("#TotalCount_SalesChallan_FY").text(_d.TotalCount_SalesChallan_FY);
                        $("#TotalAmount_SalesChallan_FY").text(_d.TotalAmount_SalesChallan_FY);


                        $("#hdGraphData_MorrisAreaChart").val(JSON.stringify(_d.GraphDataList));
                        $("#hdPieChartData_SaleAmt").val(JSON.stringify(_d.PieChartData_SaleAmt));
                        $("#hdTopCustomerList").val(JSON.stringify(_d.TopCustomerList));
                        $("#hdTopVendorList").val(JSON.stringify(_d.TopVendorList));
                        $("#hdTopSellingProductList").val(JSON.stringify(_d.TopSellingProductList));
                        Load_Morris_Area_Chart_Data();
                        drawPieChart();
                        BindTopProduct();
                        BindTopCustomer();
                        BindTopVendor();
                    }
                    else
                        alert(res.msg);
                }
            })

        };
        function BindTopProduct() {
            var data = $("#hdTopSellingProductList").val();
            if (data) {
                var list = JSON.parse(data);
                var $tbody = $("#tblTopProducts tbody");
                $tbody.empty();

                $.each(list, function (i, item) {
                    var row = `
                                                        <tr>
                                                                    <td>${item.Product}</td>
                                                                    <td>${item.TotalCount}</td>
                                                        </tr>`;
                    $tbody.append(row);
                });
            }
        }

        function BindTopCustomer() {
            var data = $("#hdTopCustomerList").val();
            if (data) {
                var list = JSON.parse(data);
                var $tbody = $("#tblTopCustomers tbody");
                $tbody.empty();

                $.each(list, function (i, item) {
                    var row = `
                                                <tr>
                                                    <td>${item.Name}</td>
                                                    <td>${item.Mobile}</td>
                                                    <td>${item.TotalCount}</td>
                                                                    <td>${item.TotalAmount}</td>
                                                        </tr>`;
                    $tbody.append(row);
                });
            }
        }
        function BindTopVendor() {
            var data = $("#hdTopVendorList").val();
            if (data) {
                var list = JSON.parse(data);
                var $tbody = $("#tblTopVendors tbody");
                $tbody.empty();

                $.each(list, function (i, item) {
                    var row = `
                                                        <tr>
                                                            <td>${item.Name}</td>
                                                            <td>${item.Mobile}</td>
                                                            <td>${item.TotalCount}</td>
                                                        </tr>`;
                    $tbody.append(row);
                });
            }
        }

    </script>
}