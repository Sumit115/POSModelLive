@model SSRepository.Models.ProdLotDtlModel

@{
    ViewData["Title"] = "Article";
    ViewData["bdClass"] = "page";
}
<div class="p-3">
    <form asp-action="Create" class="g-3" enctype="multipart/form-data">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="PkLotId" />

        <div class="row">
            <div class="col-md-12">
                <div class="row abcxyz">

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Section <span asp-validation-for="FkCatId" class="text-danger"></span></label>
                            <select asp-for="FkCatId" asp-items="@(new SelectList(ViewBag.CategoryList,"PkCategoryId","CategoryName"))" class="form-control" onchange="GetProduct()">
                            </select>

                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Sub Section <span asp-validation-for="FKProdID" class="text-danger"></span></label>

                            <select asp-for="FKProdID" asp-items="@(new SelectList(ViewBag.ProductList,"PkProductId","Product"))" class="form-control" onchange="ViewProductLot()">
                            </select>

                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Alias <span asp-validation-for="LotAlias" class="text-danger"></span></label>
                            <input asp-for="LotAlias" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Article  Name <span asp-validation-for="LotName" class="text-danger"></span></label>
                            <input asp-for="LotName" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Article  No  <span asp-validation-for="LotNo" class="text-danger"></span></label>
                            <input asp-for="LotNo" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Size <span asp-validation-for="Batch" class="text-danger"></span></label>
                            <input asp-for="Batch" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Color <span asp-validation-for="Color" class="text-danger"></span></label>
                            <input asp-for="Color" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">MRP <span asp-validation-for="MRP" class="text-danger"></span></label>
                            <input asp-for="MRP" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Sale Rate <span asp-validation-for="SaleRate" class="text-danger"></span></label>
                            <input asp-for="SaleRate" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Purchase Rate <span asp-validation-for="PurchaseRate" class="text-danger"></span></label>
                            <input asp-for="PurchaseRate" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Trade Rate <span asp-validation-for="TradeRate" class="text-danger"></span></label>
                            <input asp-for="TradeRate" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Distribution Rate <span asp-validation-for="DistributionRate" class="text-danger"></span></label>
                            <input asp-for="DistributionRate" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Mfg Date <span asp-validation-for="MfgDate" class="text-danger"></span></label>
                            <input asp-for="MfgDate" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="control-label">Expiry Date <span asp-validation-for="ExpiryDate" class="text-danger"></span></label>
                            <input asp-for="ExpiryDate" class="form-control" />

                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">Remarks<span asp-validation-for="Remarks" class="text-danger"></span></label>
                            <input asp-for="Remarks" class="form-control" />

                        </div>
                    </div>
                </div>
            </div>



        </div>

    </form>
</div>
<div>
    <div class="row">
        <div id="WUCHM1" class="col-12">
        </div>
    </div>
</div>
@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function () {
            $(".abcxyz input").val('');
            $('#PkLotId').val('0');
            $('#btnServerSave').click(function (e) {
                e.preventDefault();
                $("form").submit();
            });

            ViewProductLot();
        })

    </script>
    <script>
        function GetProduct() {
            var Id = $("#FkCatId").val();
            $("#FKProdID").empty();
            //

            if (Id > 0) {
                $.ajax({
                    type: "POST",
                    url: '/Master/Product/GetDrpProductByCatId',
                    data: { FkCatId: Id },
                    datatype: "json",
                    success: function (res) {
                        console.log(res);
                        $(res).each(function (i, v) {

                            $("#FKProdID").append("<option value='" + v.PkProductId + "'>" + v.Product + "</option>");
                        });
                    }
                })

            } else { $("#FKProdID").append("<option value=''>Select</option>"); }
        }
    </script>
    <script>
        var FormId = $("#hdFormId").val();
        var GridId = "WUCHM1", GridHeight = "90vh", pageNo = 1, pageSize = 1000, filterclass = "filter", IdProperty = "";

        function ShowGridColumn() {
            Common.GridColSetup(parseInt(FormId), '', function () {
                ViewProductLot();
            });
        }
        function ViewProductLot() {
            $('#' + GridId).empty();
            Common.Get("." + filterclass, "", function (flag, _d) {
                if ($("#FKProdID").val()>0) {

                    _d["FkProductId"] = $("#FKProdID").val();
                    $.ajax({
                        type: "POST",
                        url: '/Master/ProductLot/LotbyProductId',
                        data: _d,
                        datatype: "json",
                        success: function (res) {
                            console.log(res);
                            //if (res.status == "success") {
                            //var jo = JSON.parse(res.data);
                            bindGrid1(GridId, res, IdProperty);
                            //}
                            //else
                            //    alert(res.msg);
                        }
                    })

                }
                else { $("#WUCHM").val(''); }
            });
        };


        function bindGrid1(GridId, data, IdProperty) {
            Common.Grid(parseInt(FormId), '', function (s) {
                var cg = new coGrid("#" + GridId);
                UDI = cg;
                cg.setColumnHeading(s.ColumnHeading);
                cg.setColumnWidthPer(s.ColumnWidthPer, 1200);
                cg.setColumnFields(s.ColumnFields);
                cg.setAlign(s.Align);
                cg.defaultHeight = GridHeight;
                cg.setSearchType(s.SearchType);
                cg.setSearchableColumns(s.SearchableColumns);
                cg.setSortableColumns(s.SortableColumns);
                cg.setIdProperty('PkLotId');
                cg.setCtrlType(s.setCtrlType);
                cg.bind(data);
                cg.outGrid.setSelectionModel(new Slick.RowSelectionModel());

            });
        };
    </script>
}